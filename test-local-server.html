<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f8ff; }
        .test-box { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { margin: 5px; padding: 8px 16px; }
        #results { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
    <p>ã“ã®ãƒ†ã‚¹ãƒˆã¯å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§é‡è¦æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™</p>
    
    <div class="test-box info">
        <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆå¯¾è±¡æ©Ÿèƒ½</h3>
        <ul>
            <li>ESãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«import</li>
            <li>ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–</li>
            <li>ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ </li>
            <li>DOMæ“ä½œ</li>
            <li>çµ±åˆå‹•ä½œ</li>
        </ul>
    </div>
    
    <button onclick="runAllTests()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px;">
        ğŸš€ ãƒ†ã‚¹ãƒˆé–‹å§‹
    </button>
    <button onclick="clearResults()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px;">
        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
    </button>
    
    <div id="results"></div>
    
    <!-- å¿…è¦ãªscriptè¦ç´ ï¼ˆå®Ÿéš›ã®index.htmlã¨åŒæ§˜ï¼‰ -->
    <script src="env-config.js"></script>
    
    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testResults.push({
                time: timestamp,
                message: message,
                type: type
            });
            updateDisplay();
            console.log(`[${timestamp}] ${message}`);
        }
        
        function updateDisplay() {
            const container = document.getElementById('results');
            container.innerHTML = testResults.map(r => 
                `<div class="test-box ${r.type}">
                    <small>${r.time}</small> ${r.message}
                </div>`
            ).join('');
            container.scrollTop = container.scrollHeight;
        }
        
        function clearResults() {
            testResults = [];
            updateDisplay();
        }
        
        async function runAllTests() {
            clearResults();
            log('ğŸ¯ ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            let passedTests = 0;
            let totalTests = 0;
            
            function test(name, condition, errorMsg = '') {
                totalTests++;
                if (condition) {
                    log(`âœ… ${name}`, 'success');
                    passedTests++;
                    return true;
                } else {
                    log(`âŒ ${name}: ${errorMsg}`, 'error');
                    return false;
                }
            }
            
            try {
                // ãƒ†ã‚¹ãƒˆ1: ç’°å¢ƒè¨­å®šç¢ºèª
                log('ğŸ“‹ ãƒ†ã‚¹ãƒˆ1: ç’°å¢ƒè¨­å®šç¢ºèª', 'info');
                test('window.ENVå­˜åœ¨', !!window.ENV, 'ENVè¨­å®šãªã—');
                test('window.GEMINI_API_KEYå­˜åœ¨', !!window.GEMINI_API_KEY, 'GEMINI_API_KEYè¨­å®šãªã—');
                
                // ãƒ†ã‚¹ãƒˆ2: ESãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«import
                log('ğŸ“¦ ãƒ†ã‚¹ãƒˆ2: ESãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«import', 'info');
                
                const { COMPREHENSIVE_DIRT_MAPPING } = await import('./js/config/dirt-mapping.js');
                test('DIRT_MAPPING import', !!COMPREHENSIVE_DIRT_MAPPING, 'importå¤±æ•—');
                test('DIRT_MAPPING ãƒ‡ãƒ¼ã‚¿', Object.keys(COMPREHENSIVE_DIRT_MAPPING).length > 0, 'ãƒ‡ãƒ¼ã‚¿ãªã—');
                
                const { COMPREHENSIVE_CLEANING_PRODUCTS } = await import('./js/config/products.js');
                test('CLEANING_PRODUCTS import', !!COMPREHENSIVE_CLEANING_PRODUCTS, 'importå¤±æ•—');
                test('CLEANING_PRODUCTS ãƒ‡ãƒ¼ã‚¿', Object.keys(COMPREHENSIVE_CLEANING_PRODUCTS).length > 0, 'ãƒ‡ãƒ¼ã‚¿ãªã—');
                
                const { APIClient } = await import('./js/modules/api-client.js');
                test('APIClient import', !!APIClient, 'importå¤±æ•—');
                
                const UIComponents = (await import('./js/modules/ui-components.js')).default;
                test('UIComponents import', !!UIComponents, 'importå¤±æ•—');
                
                const RealtimeSearchEngine = (await import('./js/modules/search-engine.js')).default;
                test('SearchEngine import', !!RealtimeSearchEngine, 'importå¤±æ•—');
                
                // ãƒ†ã‚¹ãƒˆ3: ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
                log('ğŸ—ï¸ ãƒ†ã‚¹ãƒˆ3: ã‚¯ãƒ©ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', 'info');
                
                const apiClient = new APIClient();
                test('APIClient ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', !!apiClient, 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–å¤±æ•—');
                test('enrichProductsWithAmazonData ãƒ¡ã‚½ãƒƒãƒ‰', typeof apiClient.enrichProductsWithAmazonData === 'function', 'ãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                test('getStatus ãƒ¡ã‚½ãƒƒãƒ‰', typeof apiClient.getStatus === 'function', 'ãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                
                const uiComponents = new UIComponents();
                test('UIComponents ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', !!uiComponents, 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–å¤±æ•—');
                test('EventTargetç¶™æ‰¿', uiComponents instanceof EventTarget, 'EventTargetç¶™æ‰¿ãªã—');
                test('on ãƒ¡ã‚½ãƒƒãƒ‰', typeof uiComponents.on === 'function', 'ãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                test('emit ãƒ¡ã‚½ãƒƒãƒ‰', typeof uiComponents.emit === 'function', 'ãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                
                const searchEngine = new RealtimeSearchEngine();
                test('SearchEngine ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–', !!searchEngine, 'ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–å¤±æ•—');
                test('searchProductsByDirt ãƒ¡ã‚½ãƒƒãƒ‰', typeof searchEngine.searchProductsByDirt === 'function', 'ãƒ¡ã‚½ãƒƒãƒ‰ãªã—');
                
                // ãƒ†ã‚¹ãƒˆ4: ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
                log('ğŸ“¡ ãƒ†ã‚¹ãƒˆ4: ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ', 'info');
                
                let eventReceived = false;
                let receivedData = null;
                
                uiComponents.on('test-event', (event) => {
                    eventReceived = true;
                    receivedData = event.detail;
                });
                
                uiComponents.emit('test-event', 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿');
                
                // å°‘ã—å¾…ã£ã¦ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª
                await new Promise(resolve => setTimeout(resolve, 50));
                
                test('ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡', eventReceived, 'ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡å¤±æ•—');
                test('ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿', receivedData === 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿', 'ãƒ‡ãƒ¼ã‚¿ä¸ä¸€è‡´');
                
                // ãƒ†ã‚¹ãƒˆ5: æ¤œç´¢æ©Ÿèƒ½
                log('ğŸ” ãƒ†ã‚¹ãƒˆ5: æ¤œç´¢æ©Ÿèƒ½', 'info');
                
                const searchResults = await searchEngine.searchProductsByDirt('æ²¹æ±šã‚Œ', 'heavy', 'kitchen');
                test('æ¤œç´¢å®Ÿè¡Œ', Array.isArray(searchResults), 'æ¤œç´¢å¤±æ•—');
                test('æ¤œç´¢çµæœ', searchResults.length >= 0, 'çµæœãªã—');
                
                // ãƒ†ã‚¹ãƒˆ6: DOMæ“ä½œ
                log('ğŸ—ï¸ ãƒ†ã‚¹ãƒˆ6: DOMæ“ä½œ', 'info');
                
                const testDiv = document.createElement('div');
                testDiv.id = 'test-element';
                testDiv.innerHTML = 'ãƒ†ã‚¹ãƒˆè¦ç´ ';
                document.body.appendChild(testDiv);
                
                const foundElement = document.getElementById('test-element');
                test('DOMè¦ç´ ä½œæˆ', !!foundElement, 'è¦ç´ ä½œæˆå¤±æ•—');
                test('innerHTMLè¨­å®š', foundElement.innerHTML === 'ãƒ†ã‚¹ãƒˆè¦ç´ ', 'innerHTMLå¤±æ•—');
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                document.body.removeChild(testDiv);
                
                // æœ€çµ‚çµæœ
                log('', 'info');
                const successRate = ((passedTests / totalTests) * 100).toFixed(1);
                
                if (passedTests === totalTests) {
                    log(`ğŸ‰ğŸ‰ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸï¼(${passedTests}/${totalTests})`, 'success');
                    log('ğŸ’¯ ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®å‹•ä½œç¢ºèªå®Œäº†', 'success');
                    log('ğŸš€ æœ¬ç•ªç’°å¢ƒã§ã‚‚å®Œç’§ã«å‹•ä½œã—ã¾ã™ï¼', 'success');
                } else {
                    log(`âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆå¤±æ•—: ${passedTests}/${totalTests} (${successRate}%)`, 'error');
                }
                
            } catch (error) {
                log(`ğŸ’¥ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('è©³ç´°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬ãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', () => {
            log('ğŸ“„ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†', 'info');
            log('ğŸ’¡ ã€Œãƒ†ã‚¹ãƒˆé–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„', 'info');
        });
    </script>
</body>
</html>