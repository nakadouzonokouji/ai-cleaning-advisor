<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>é‡è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
</head>
<body>
    <h1>ğŸ”¬ é‡è¦æ©Ÿèƒ½ç¢ºèªãƒ†ã‚¹ãƒˆ</h1>
    <div id="status">ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...</div>
    
    <!-- å ´æ‰€ãƒœã‚¿ãƒ³ã®ãƒ†ã‚¹ãƒˆ -->
    <div style="margin: 20px 0;">
        <h3>å ´æ‰€ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆ</h3>
        <button data-location="kitchen" class="location-btn">ã‚­ãƒƒãƒãƒ³</button>
        <button data-location="bathroom" class="location-btn">ãƒã‚¹ãƒ«ãƒ¼ãƒ </button>
    </div>
    
    <script type="module">
        const status = document.getElementById('status');
        let testResults = [];
        
        function updateStatus(msg) {
            testResults.push(msg);
            status.innerHTML = testResults.join('<br>');
            console.log(msg);
        }
        
        try {
            updateStatus('ğŸš€ é‡è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // 1. AICleaningAdvisorã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãƒ†ã‚¹ãƒˆ
            updateStatus('ğŸ“± app.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆä¸­...');
            
            const module = await import('./app.js');
            updateStatus('âœ… app.jsã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ');
            
            // 2. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ç¢ºèª
            updateStatus('ğŸ” ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ç¢ºèªä¸­...');
            
            const { COMPREHENSIVE_DIRT_MAPPING } = await import('./js/config/dirt-mapping.js');
            const { APIClient } = await import('./js/modules/api-client.js');
            const UIComponents = (await import('./js/modules/ui-components.js')).default;
            
            updateStatus(`âœ… æ±šã‚Œãƒ‡ãƒ¼ã‚¿: ${Object.keys(COMPREHENSIVE_DIRT_MAPPING).length}ç¨®é¡`);
            updateStatus('âœ… APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆèª­ã¿è¾¼ã¿æˆåŠŸ');
            updateStatus('âœ… UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆèª­ã¿è¾¼ã¿æˆåŠŸ');
            
            // 3. åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
            updateStatus('ğŸ§ª åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
            
            const apiClient = new APIClient();
            updateStatus('âœ… APIClient ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æˆåŠŸ');
            
            const uiComponents = new UIComponents();
            updateStatus('âœ… UIComponents ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–æˆåŠŸ');
            
            // 4. é‡è¦ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª
            const criticalMethods = [
                { obj: apiClient, method: 'enrichProductsWithAmazonData' },
                { obj: apiClient, method: 'getStatus' },
                { obj: uiComponents, method: 'on' },
                { obj: uiComponents, method: 'emit' },
                { obj: uiComponents, method: 'updateStatusInfo' }
            ];
            
            criticalMethods.forEach(test => {
                if (typeof test.obj[test.method] === 'function') {
                    updateStatus(`âœ… ${test.method}ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨`);
                } else {
                    updateStatus(`âŒ ${test.method}ãƒ¡ã‚½ãƒƒãƒ‰ä¸åœ¨`);
                }
            });
            
            // 5. ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
            updateStatus('ğŸ“¡ ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ...');
            
            let eventWorking = false;
            uiComponents.on('test-event', (event) => {
                eventWorking = true;
                updateStatus(`âœ… ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æˆåŠŸ: ${event.detail}`);
            });
            
            uiComponents.emit('test-event', 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿');
            
            // 6. DOMè¦ç´ ãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                updateStatus('ğŸ¯ DOMè¦ç´ ãƒ†ã‚¹ãƒˆ...');
                
                const locationButtons = document.querySelectorAll('[data-location]');
                updateStatus(`âœ… å ´æ‰€ãƒœã‚¿ãƒ³æ¤œå‡º: ${locationButtons.length}å€‹`);
                
                if (eventWorking) {
                    updateStatus('âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª');
                } else {
                    updateStatus('âš ï¸ ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡å¾…æ©Ÿä¸­...');
                }
                
                // æœ€çµ‚åˆ¤å®š
                setTimeout(() => {
                    const errors = testResults.filter(r => r.includes('âŒ')).length;
                    if (errors === 0) {
                        updateStatus('');
                        updateStatus('ğŸ‰ğŸ‰ğŸ‰ å…¨é‡è¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆæˆåŠŸï¼');
                        updateStatus('ğŸ’¯ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆå®Œç’§ã«å‹•ä½œä¸­');
                        updateStatus('ğŸš€ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™å®Œäº†');
                    } else {
                        updateStatus('');
                        updateStatus(`âš ï¸ ${errors}ä»¶ã®ã‚¨ãƒ©ãƒ¼ã‚ã‚Š - ä¿®æ­£å¿…è¦`);
                    }
                }, 500);
            }, 100);
            
        } catch (error) {
            updateStatus(`ğŸ’¥ è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            console.error('ã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
        }
    </script>
</body>
</html>